<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time User Count</title>
  </head>
  <body>
    <h1>Racing Arena</h1>
    <h1>Currently online: <span id="userCount">0</span></h1>
    <div>
      <label for="usernameInput" id="usernamePrompt"
        >Enter your username:</label
      >
      <input type="text" id="usernameInput" maxlength="10" />
      <button id="checkUsername">Submit</button>
    </div>
    <div id="resultMessage"></div>
    <div>Successfully registered players:</div>
    <br />
    <textarea
      name="player_list"
      id="player_list"
      cols="30"
      rows="10"
      readonly="readonly"
      placeholder="Player list"
    ></textarea>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let input = document.getElementById("usernameInput");
      let submitBtn = document.getElementById("checkUsername");
      let players_textarea = document.getElementById("player_list");

      socket.on("userCount", (count) => {
        document.getElementById("userCount").textContent = count;
      });

      socket.on("update player list", function (player_list) {
        /*
        var item = document.createElement("li");
        item.textContent = msg.username + ": " + msg.message;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
        */
        let players_string = "";
        for (let i = 0; i < player_list.length; i++) {
          players_string = players_string.concat(player_list.list[i]);
          players_string = players_string.concat("\n");
        }
        players_textarea.textContent = players_string;
      });
      socket.on("register successful", function () {
        input.readOnly = true;
        submitBtn.style.display = "none";
        resultMessage.textContent = "Registration completed successfully";
        document.getElementById("usernamePrompt").textContent =
          "Your username: ";
      });
      socket.on("username already exists", function () {
        resultMessage.textContent = "Username already taken by another player";
      });
      socket.on("not allowed username", function () {
        resultMessage.textContent = "Allowed characters: [A-Z][a-z][0-9][_]";
      });
      function update_player_list(player_list) {
        return 0;
      }

      submitBtn.onclick = function () {
        socket.emit("check username", input.value);
      };
    </script>
  </body>
</html>
