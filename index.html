<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time User Count</title>
    <style>
      .overlay-center {
        position: fixed; /* Fixed positioning relative to the viewport */
        top: 0;
        left: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        z-index: -1; /* Ensure the overlay is below everything else */
      }
      .overlay-content {
        text-align: center; /* Center content horizontally */
      }
      #readyToPlay {
        font-size: 28px;
      }
    </style>
  </head>
  <h1>Racing Arena</h1>
  <body>
    <div id="player_registration">
      <h1>Currently online: <span id="userCount">0</span></h1>
      <h1>Registered players: <span id="registeredCount">0</span></h1>
      <div>
        <label for="usernameInput" id="usernamePrompt"
          >Enter your username:</label
        >
        <input type="text" id="usernameInput" maxlength="10" />
        <button id="checkUsername">Submit</button>
      </div>
      <div id="resultMessage"></div>
      <div>Successfully registered players:</div>
      <br />
      <textarea
        name="player_list"
        id="player_list"
        cols="30"
        rows="10"
        readonly="readonly"
        placeholder="Player list"
      ></textarea>
      <br />
      <button id="startGame" style="width: 150px; height: 50px; display: none">
        Start Game
      </button>
    </div>
    <div class="overlay-center">
      <div class="overlay-content">
        <p id="readyToPlay" style="display: none">Placeholder text</p>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let input = document.getElementById("usernameInput");
      let submitBtn = document.getElementById("checkUsername");
      let players_textarea = document.getElementById("player_list");
      let startGameBtn = document.getElementById("startGame");
      let player_registration_group = document.getElementById(
        "player_registration"
      );

      socket.on("userCount", function (user_count) {
        document.getElementById("userCount").textContent =
          user_count.connectedUsers;
        document.getElementById("registeredCount").textContent =
          user_count.registeredPlayers;
      });

      socket.on("update player list", function (player_list) {
        console.log("Accessing update player list function");
        let players_string = "";
        for (let i = 0; i < player_list.length; i++) {
          players_string = players_string.concat(player_list.list[i]);
          players_string = players_string.concat("\n");
        }
        players_textarea.textContent = players_string;
      });

      socket.on("start game button trigger", function (state) {
        if (state.server_registeredPlayers >= 2) {
          document.getElementById("startGame").style.display = "block";
          console.log("Display start button");
        } else {
          document.getElementById("startGame").style.display = "none";
          console.log("Hide start button");
        }
      });

      socket.on("register successful", function (registeredPlayers) {
        input.readOnly = true;
        submitBtn.style.display = "none";
        resultMessage.textContent = "Registration completed successfully";
        document.getElementById("usernamePrompt").textContent =
          "Your username: ";
        document.getElementById("registeredCount").textContent =
          registeredPlayers;
      });
      /*
      socket.on("startGame button state", function (state) {
        if (state.registeredPlayers >= 2 && state.has_registered) {
          document.getElementById("startGame").style.display = "block";
        } else {
          document.getElementById("startGame").style.display = "none";
        }
      });
      */
      socket.on("maximum players", function (PLAYER_LIMIT) {
        resultMessage.textContent =
          "Maximum number of players: " + PLAYER_LIMIT;
      });
      socket.on("username already exists", function () {
        resultMessage.textContent = "Username already taken by another player";
      });
      socket.on("not allowed username", function () {
        resultMessage.textContent = "Allowed characters: [A-Z][a-z][0-9][_]";
      });
      socket.on("clear screen", function () {
        player_registration_group.style.display = "none";
      });
      socket.on("allowed to play", function () {
        document.getElementById("readyToPlay").textContent =
          "One player has started the game and you have registered successfully.";
        document.getElementById("readyToPlay").style.display = "block";
      });
      socket.on("not allowed to play", function () {
        document.getElementById("readyToPlay").textContent =
          "The game has already started, please wait for the current game to end.";
        document.getElementById("readyToPlay").style.display = "block";
      });
      submitBtn.onclick = function () {
        socket.emit("check username", input.value);
      };
      startGameBtn.onclick = function () {
        socket.emit("start game");
      };
    </script>
  </body>
</html>
